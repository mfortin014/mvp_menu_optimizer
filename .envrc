# .envrc — uses Bitwarden to inject all project secrets into the shell
# ask user to provide access token
if [ -z "${BWS_ACCESS_TOKEN:-}" ]; then
  if [ -t 0 ]; then
    read -s -p "Bitwarden machine token: " BWS_ACCESS_TOKEN; echo
    export BWS_ACCESS_TOKEN
  else
    echo "[direnv] BWS_ACCESS_TOKEN missing and no TTY to prompt. Run: export BWS_ACCESS_TOKEN=…"
    exit 1
  fi
fi

# set project uuid
PROJECT_ID="4b5e71e8-c979-4125-acba-b37101280d71"

# Ensure the CLI exists
command -v bws >/dev/null 2>&1 || { echo "bws not found. Install bws first."; exit 1; }

# Export all project secrets:
# Prefix each line with `export` so they are set as env variable for this shell.
eval "$(bws secret list "$PROJECT_ID" -o env | sed 's/^/export /')"

# Confirm (names only; no values)
echo "[direnv] BWS injected: $(bws secret list "$PROJECT_ID" -o env | cut -d= -f1 | xargs)"
