# .envrc — BWS is opt-in via pre-set token; VS Code owns venv activation

PROJECT_ID="4b5e71e8-c979-4125-acba-b37101280d71"  # paste the real UUID

# if bws isn’t on PATH, do nothing
command -v bws >/dev/null 2>&1 || { echo "[direnv] bws not found; skipping"; return; }

# if no token, do nothing (venv still active via VS Code)
if [ -z "${BWS_ACCESS_TOKEN:-}" ]; then
  echo "[direnv] No BWS token. To inject: export BWS_ACCESS_TOKEN=… && direnv reload"
  return
fi

# token present → inject all secrets (export KEY=VALUE)
if bws project list -o none >/dev/null 2>&1; then
  eval "$(bws secret list "$PROJECT_ID" -o env | sed 's/^/export /')"
  echo "[direnv] BWS injected: $(bws secret list "$PROJECT_ID" -o env | cut -d= -f1 | xargs)"
else
  echo "[direnv] BWS token invalid; skipping"
fi
